# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• Ğ¡Ğ•Ğ Ğ’Ğ˜Ğ¡ĞĞœĞ˜
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

manage_start() {
    (
        cd /opt/remnawave
        docker compose up -d >/dev/null 2>&1
    ) &
    show_spinner "Ğ—Ğ°Ğ¿ÑƒÑĞº ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²"
    print_success "Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ñ‹"
    echo
    read -s -n 1 -p "$(echo -e "${DARKGRAY}ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Enter Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ñ${NC}")"
        echo
}

manage_stop() {
    (
        cd /opt/remnawave
        docker compose down >/dev/null 2>&1
    ) &
    show_spinner "ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²"
    print_success "Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹"
    echo
    read -s -n 1 -p "$(echo -e "${DARKGRAY}ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Enter Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ñ${NC}")"
        echo
}

manage_update() {
    clear
    echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${GREEN}   ğŸ”„ ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞšĞĞœĞŸĞĞĞ•ĞĞ¢ĞĞ’${NC}"
    echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    (
        cd /opt/remnawave
        docker compose pull >/dev/null 2>&1
    ) &
    show_spinner "Ğ¡ĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹"

    (
        cd /opt/remnawave
        docker compose up -d >/dev/null 2>&1
    ) &
    show_spinner "ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²"

    (
        docker image prune -af >/dev/null 2>&1
    ) &
    show_spinner "ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²"

    print_success "ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾"
    echo
    read -s -n 1 -p "$(echo -e "${DARKGRAY}ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Enter Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ñ${NC}")"
        echo
}

manage_logs() {
    clear
    echo -e "${YELLOW}Ğ”Ğ»Ñ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ° Ğ¸Ğ· Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ctrl+C${NC}"
    sleep 1
    cd /opt/remnawave
    docker compose logs -f -t --tail 100
}

manage_reinstall() {
    clear
    echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${RED}   ğŸ—‘ï¸ ĞŸĞ•Ğ Ğ•Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ${NC}"
    echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo

    echo -e "${RED}âš ï¸  Ğ’ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ±ÑƒĞ´ÑƒÑ‚ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹!${NC}"

    if ! confirm_action; then
        return
    fi

    (
        cd /opt/remnawave
        docker compose down -v --rmi all >/dev/null 2>&1
        docker system prune -af >/dev/null 2>&1
    ) &
    show_spinner "Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ² Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"

    (
        rm -f /opt/remnawave/.env
        rm -f /opt/remnawave/docker-compose.yml
        rm -f /opt/remnawave/nginx.conf
    ) &
    show_spinner "ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸"

    print_success "Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ Ğº Ğ¿ĞµÑ€ĞµÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ"

    show_arrow_menu "ğŸ“¦ Ğ’Ğ«Ğ‘Ğ•Ğ Ğ˜Ğ¢Ğ• Ğ¢Ğ˜ĞŸ Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ˜" \
        "ğŸ“¦  ĞŸĞ°Ğ½ĞµĞ»ÑŒ + ĞĞ¾Ğ´Ğ° (Ğ¾Ğ´Ğ¸Ğ½ ÑĞµÑ€Ğ²ĞµÑ€)" \
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" \
        "ğŸ–¥ï¸   Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ" \
        "ğŸŒ  Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ¾Ğ´Ğ°" \
        "â•  ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ´Ñƒ Ğ² Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ" \
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" \
        "âŒ  ĞĞ°Ğ·Ğ°Ğ´"
    local choice=$?

    case $choice in
        0) installation_full ;;
        1) continue ;;
        2) installation_panel ;;
        3) installation_node ;;
        4) add_node_to_panel ;;
        5) continue ;;
        6) return ;;
    esac
}
